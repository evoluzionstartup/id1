<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ID1 | Identidade Digital Evoluzion</title>
  
  <!-- PWA: Link para o arquivo manifest.json -->
  <link rel="manifest" href="/manifest.json">

  <style>
    body { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
      margin: 0; 
      padding: 0; 
      text-align: center; 
      background: #f5f5f5; 
      color: #333; 
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    header { 
      background: #2c3e50; /* Cor escura do cabe√ßalho */
      color: white; 
      padding: 1rem; 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    header h1 { 
      margin: 0; 
      font-size: 1.8rem; 
    }
    header button { 
      background: white; 
      color: #2c3e50; /* Cor do cabe√ßalho */
      border: none; 
      padding: 0.6rem 1.2rem; 
      border-radius: 5px; 
      cursor: pointer; 
      font-size: 1rem;
      transition: background-color 0.3s ease;
    }
    header button:hover {
      background-color: #e0e0e0;
    }
    main { 
      flex-grow: 1;
      padding: 2rem; 
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .section-card { 
      background: #ffffff; 
      padding: 2.5rem; 
      border-radius: 1rem; 
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      width: 100%;
      max-width: 700px;
      margin-bottom: 30px;
      text-align: left; /* Alinha o texto dentro do card */
    }
    .section-card h2, .section-card h3 {
        color: #34495e;
        margin-bottom: 1.5rem;
        text-align: center; /* Centraliza t√≠tulos dentro do card */
    }
    .section-card p {
        color: #555;
        line-height: 1.6;
        margin-bottom: 1rem;
    }
    .section-card ul {
        list-style: none;
        padding: 0;
        margin-top: 15px;
    }
    .section-card ul li {
        margin-bottom: 8px;
    }
    .section-card ul li a {
        color: #4a90e2;
        text-decoration: none;
        font-weight: bold;
    }
    .section-card ul li a:hover {
        text-decoration: underline;
    }
    .highlight-number {
        font-size: 2.2rem;
        font-weight: bold;
        color: #007bff; /* Azul vibrante para n√∫meros */
        display: block;
        margin: 15px 0;
        text-align: center;
    }
    .number-extenso {
        font-size: 1.1rem;
        font-style: italic;
        color: #6c757d;
        text-align: center;
        margin-top: 10px;
    }
    .status-message {
        font-weight: bold;
        color: #e74c3c;
        margin-top: 1rem;
        text-align: center;
    }
    .user-count {
        font-weight: bold;
        color: #2c3e50;
        font-size: 1.2rem;
        text-align: center;
        margin-bottom: 20px;
    }
    footer { 
      background: #2c3e50; 
      color: white; 
      padding: 1rem; 
      margin-top: auto; 
      box-shadow: 0 -2px 5px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>
  <header>
    <h1>ID1: Identidade Digital Evoluzion</h1>
    <button id="loginGoogle">Login com Google</button>
  </header>

  <main>
    <div class="section-card">
      <h2>üåç Bem-vindo √† identidade digital universal</h2>
      <p>Uma s√≥ identidade. Um s√≥ planeta. Um s√≥ povo.</p>
      <p id="status" class="status-message"></p>
      <p id="userCount" class="user-count">Total de identidades digitais emitidas: Carregando...</p>
    </div>

    <div class="section-card">
      <h2>Popula√ß√£o Mundial</h2>
      <p>A popula√ß√£o humana √© o nosso maior recurso. Estimamos a popula√ß√£o atual do planeta em:</p>
      <span id="worldPopulationDisplay" class="highlight-number">Carregando...</span>
      
      <h3>Fontes de Consulta:</h3>
      <ul>
        <li><a href="https://www.un.org/development/desa/pd/content/world-population-prospects" target="_blank" rel="noopener noreferrer">Na√ß√µes Unidas (ONU) - World Population Prospects</a></li>
        <li><a href="https://data.worldbank.org/indicator/SP.POP.TOTL" target="_blank" rel="noopener noreferrer">Banco Mundial - Popula√ß√£o Total</a></li>
        <li><a href="https://www.worldometers.info/world-population/" target="_blank" rel="noopener noreferrer">Worldometer - Contador de Popula√ß√£o Mundial</a></li>
      </ul>
    </div>

    <div class="section-card">
      <h2>O Maior Ativo da Humanidade</h2>
      <p>Considerando que cada humano tenha o m√≠nimo de tempo de vida atribu√≠do de 122 anos, 5 meses e 14 dias (44724 dias), o potencial de vida total da humanidade √©:</p>
      <span id="humanityAssetNumber" class="highlight-number">Calculando...</span>
      <p id="humanityAssetExtenso" class="number-extenso"></p>
      <p style="text-align: center; font-size: 1.2rem; font-weight: bold; color: #28a745; margin-top: 20px;">
        Esse √© o maior ativo da humanidade.
      </p>
    </div>
  </main>

  <footer>
    <p>&copy; 2025 Evoluzion. Todos os direitos reservados.</p>
  </footer>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc, collection, getCountFromServer } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    // ATEN√á√ÉO: SUBSTITUA ESTA CONFIGURA√á√ÉO PELA SUA CONFIGURA√á√ÉO REAL DO FIREBASE!
    // Voc√™ pode encontr√°-la no seu Console do Firebase > Configura√ß√µes do Projeto > Seus Apps > Web.
    const firebaseConfig = {
      apiKey: "AIzaSyDUOF7BZIBNfJBXVmT2MGMMF6EBnUfsesk", // Substitua pela sua chave real
      authDomain: "evoluzion-id1.firebaseapp.com",
      projectId: "evoluzion-id1",
      storageBucket: "evoluzion-id1.appspot.com",
      messagingSenderId: "413091065593",
      appId: "1:413091065593:web:3527d66e02a2bf2f767c28"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const loginGoogleButton = document.getElementById("loginGoogle");
    const statusParagraph = document.getElementById("status");
    const userCountParagraph = document.getElementById("userCount");
    const worldPopulationDisplay = document.getElementById("worldPopulationDisplay");
    const humanityAssetNumber = document.getElementById("humanityAssetNumber");
    const humanityAssetExtenso = document.getElementById("humanityAssetExtenso");

    const provider = new GoogleAuthProvider();

    // --- Constantes para o c√°lculo ---
    const WORLD_POPULATION_ESTIMATE = 8100000000; // Estimativa de 8.1 bilh√µes (Julho de 2025)
    const JEANNE_CALMENT_LIFESPAN_DAYS = 44724; // 122 anos, 5 meses e 14 dias em dias

    // --- Fun√ß√£o para converter n√∫mero para extenso em Portugu√™s (mais robusta) ---
    function numberToExtenso(num) {
        if (num === 0) return "zero";
        if (num < 0) return "menos " + numberToExtenso(Math.abs(num));

        const unidades = ["", "um", "dois", "tr√™s", "quatro", "cinco", "seis", "sete", "oito", "nove"];
        const especiais = ["dez", "onze", "doze", "treze", "quatorze", "quinze", "dezesseis", "dezessete", "dezoito", "dezenove"];
        const dezenas = ["", especiais[0], "vinte", "trinta", "quarenta", "cinquenta", "sessenta", "setenta", "oitenta", "noventa"];
        const centenas = ["", "cento", "duzentos", "trezentos", "quatrocentos", "quinhentos", "seiscentos", "setecentos", "oitocentos", "novecentos"];
        const grandezas = [
            ["", ""], ["mil", "mil"], ["milh√£o", "milh√µes"], ["bilh√£o", "bilh√µes"], ["trilh√£o", "trilh√µes"]
        ];

        function converterChunk(n) {
            let s = "";
            let c = Math.floor(n / 100);
            let d = Math.floor((n % 100) / 10);
            let u = n % 10;

            if (n === 100) return "cem";
            if (c > 0) s += centenas[c];

            if (d === 1 && u > 0) {
                if (s !== "") s += " e ";
                s += especiais[u];
            } else {
                if (d > 0) {
                    if (s !== "") s += " e ";
                    s += dezenas[d];
                }
                if (u > 0) {
                    if (s !== "" && (d !== 0 || c !== 0)) s += " e ";
                    s += unidades[u];
                }
            }
            return s;
        }

        let strNum = String(num);
        let chunks = [];
        while (strNum.length > 0) {
            chunks.unshift(parseInt(strNum.slice(-3), 10));
            strNum = strNum.slice(0, -3);
        }

        let resultado = [];
        for (let i = 0; i < chunks.length; i++) {
            let chunk = chunks[i];
            if (chunk === 0 && chunks.length > 1 && i !== chunks.length -1) continue; // Pula zeros intermedi√°rios

            let textoChunk = converterChunk(chunk);
            let grandeza = grandezas[chunks.length - 1 - i];

            if (textoChunk !== "") {
                if (grandeza[0] !== "") {
                    if (chunk === 1 && grandeza[0] !== "mil") {
                        resultado.push(textoChunk + " " + grandeza[0]);
                    } else if (chunk > 1 && grandeza[1] !== "") {
                        resultado.push(textoChunk + " " + grandeza[1]);
                    } else { // Para "mil" ou quando n√£o h√° plural
                        resultado.push(textoChunk + (grandeza[0] ? " " + grandeza[0] : ""));
                    }
                } else {
                    resultado.push(textoChunk);
                }
            }
        }
        return resultado.join(" e ");
    }


    // --- Google Login ---
    loginGoogleButton.addEventListener("click", async () => {
      try {
        statusParagraph.textContent = "Autenticando...";
        const result = await signInWithPopup(auth, provider);
        const user = result.user;

        const userRef = doc(db, "users", user.uid);
        const userSnap = await getDoc(userRef);

        if (!userSnap.exists()) {
          await setDoc(userRef, {
            email: user.email,
            name: user.displayName || "",
            createdAt: new Date(),
            accumulatedDigitalScreenTimeMs: 0 
          }, { merge: true });
          statusParagraph.textContent = "Novo usu√°rio registrado e logado!";
        } else {
          statusParagraph.textContent = "Usu√°rio existente logado!";
        }

        console.log("Usu√°rio logado:", user.displayName);
        window.location.href = "./perfil.html";
      } catch (error) {
        console.error("Erro no login:", error);
        statusParagraph.textContent = `Erro ao logar com Google: ${error.message}`;
      }
    });

    // --- Fun√ß√£o para atualizar a contagem de usu√°rios ---
    async function updateUserCount() {
      try {
        console.log("Tentando obter contagem de identidades digitais...");
        const usersCollectionRef = collection(db, "users");
        const snapshot = await getCountFromServer(usersCollectionRef);
        userCountParagraph.textContent = `Total de identidades digitais emitidas: ${snapshot.data().count}`;
        console.log("Contagem de identidades digitais obtida com sucesso:", snapshot.data().count);
      } catch (error) {
        console.error("Erro ao obter contagem de identidades digitais:", error);
        userCountParagraph.textContent = "Erro ao carregar contagem.";
      }
    }

    // --- Fun√ß√£o para calcular e exibir o "Maior Ativo da Humanidade" ---
    function displayHumanityAsset() {
        const totalAssetDays = WORLD_POPULATION_ESTIMATE * JEANNE_CALMENT_LIFESPAN_DAYS;
        humanityAssetNumber.textContent = totalAssetDays.toLocaleString('pt-BR') + " dias"; // Formata com separador de milhares
        humanityAssetExtenso.textContent = numberToExtenso(totalAssetDays) + " dias";
    }

    // --- Monitora o estado de autentica√ß√£o para redirecionar ou atualizar contador ---
    onAuthStateChanged(auth, (user) => {
      if (user) {
        // Se j√° estiver logado, redireciona para o perfil imediatamente
        window.location.href = "./perfil.html";
      } else {
        // Se n√£o estiver logado, atualiza a contagem e exibe os dados da p√°gina inicial
        updateUserCount();
        worldPopulationDisplay.textContent = WORLD_POPULATION_ESTIMATE.toLocaleString('pt-BR');
        displayHumanityAsset();
      }
    });

    // --- PWA: Registro do Service Worker ---
    document.addEventListener("DOMContentLoaded", () => {
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/service-worker.js')
            .then((registration) => {
              console.log('Service Worker registrado com sucesso:', registration.scope);
            })
            .catch((error) => {
              console.error('Falha no registro do Service Worker:', error);
            });
        });
      }
    });
  </script>
</body>
</html>
